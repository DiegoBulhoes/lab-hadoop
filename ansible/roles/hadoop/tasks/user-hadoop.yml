- name: Add the user {{user_name}}
  user:
    name: "{{user_name}}"
    password: "{{user_password}} | password_hash('sha512') }}"
    shell: /bin/bash
    generate_ssh_key: yes

- name: "Get key public - Master - id_rsa.pub"
  slurp:
    src: "/home/{{user_name}}/.ssh/id_rsa.pub"
  register: "ssh_public_hadoop"
  delegate_to: "{{ip_master}}"

- name: "Create file - authorized_keys"
  authorized_key:
    user: "{{user_name}}"
    key: "{{ssh_public_hadoop['content'] | b64decode}}"

- name: "Change hadoop files permission"
  file:
    path: "{{hadoop_base}}"
    group: "{{user_name}}"
    owner: "{{user_name}}"
